<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>JS Unit Test</title>
    <link rel="stylesheet"
          href="https://code.jquery.com/qunit/qunit-2.19.1.css">
</head>
<body>
<div id="qunit"></div>
<div id="qunit-fixture">
    <div class="article-list-container">
    <button class="search-button" id="toggle-search-btn" type="button" title="Пошук">
        <i class="fa fa-search"></i>
    </button>

    <h1>Всі новини</h1>

    <div id="author-container" class="canvas-container">
        <canvas id="authorCanvas" width="120" height="120"></canvas>
    </div>
    <div id="tag-container" class="canvas-container">
        <canvas id="tagCanvas" width="120" height="120"></canvas>
    </div>

    <!-- Додаємо кнопку "Всі автори" -->
    <div id="authorTags">
        <a href="#" class="tag-item all-authors active" data-author="">Всі автори</a>
        {% for author in authors %}
            <a href="#" class="tag-item" data-author="{{ author.id }}">{{ author.name }}</a>
        {% endfor %}
    </div>

    <!-- Додаємо кнопку "Всі теги" -->
    <div id="tagTags">
        <a href="#" class="tag-item all-tags active" data-tag="">Всі теги</a>
        {% for tag in tags %}
            <a href="#" class="tag-item" data-tag="{{ tag.id }}">{{ tag.name }}</a>
        {% endfor %}
    </div>

    <p>Ознайомтесь із останніми новинами, які ми публікуємо.</p>

    <!-- Фільтри -->
    <div class="filter-section">
        <form method="get" class="form-inline">
            <div class="form-group">
                <label for="date">Дата:</label>
                <input type="date" id="date" name="date" class="form-control" value="{{ request.GET.date }}" onchange="this.form.submit()">
            </div>
            <div class="form-group">
                <label for="sort">Сортувати за:</label>
                <select id="sort" name="sort" class="form-control" onchange="this.form.submit()">
                    <option value="views" {% if request.GET.sort == "views" %}selected{% endif %}>Переглядами</option>
                    <option value="comments" {% if request.GET.sort == "comments" %}selected{% endif %}>Коментарями</option>
                    <option value="saves" {% if request.GET.sort == "saves" %}selected{% endif %}>Збереженнями</option>
                </select>
            </div>
        </form>
    </div>

    <!-- Пошук -->
    <div class="search-section" id="search-section" style="display: none">
        <form method="get" class="form-inline mb-3 search-form">
            <div class="form-group search-field">
                <label for="search" class="mr-2">Пошук новини: </label>
                <input id="search" type="text" name="query" class="form-control" placeholder="Пошук..." value="{{ request.GET.query }}">
                <button type="submit" class="btn search-btn">Шукати</button>
            </div>
            {% if is_admin %}
                <div class="add-new">
                    <a href="{% url 'article-add' %}" class="btn add-article-btn">Додати новину</a>
                </div>
            {% endif %}
        </form>
    </div>

    <!-- Список статей -->
    <div class="article-list">
        {% for article in articles %}
        <div class="article-item">
            {% if article.image %}
            <img src="{{ article.image.url }}" alt="{{ article.title }}" class="article-image">
            {% endif %}
            <h3>{{ article.title }}</h3>
            <p class="meta">
                Автор: {{ article.author.name }} | Дата: {{ article.date_of_publication|date:"d.m.Y" }}
                {% if is_admin %}
                    | Перегляди: {{ article.views_count }}
                    | Коментарі: {{ article.num_comments }}
                    | Збереження: {{ article.num_saves }}
                {% endif %}
            </p>
            <p>{{ article.article_text|truncatewords:30 }}</p>
            <a href="{% url 'article-detail' article.pk %}" class="btn read-more-btn">Читати далі</a>
        </div>
        {% empty %}
        <p>Новин не знайдено.</p>
        {% endfor %}
    </div>

    <!-- Пагінація -->
    {% if is_paginated %}
    <nav class="pagination-container">
        <ul class="pagination">
            {% if page_obj.has_previous %}
            <li><a href="?page={{ page_obj.previous_page_number }}">&laquo; Попередня</a></li>
            {% endif %}
            {% for num in page_obj.paginator.page_range %}
            <li class="{% if page_obj.number == num %}active{% endif %}">
                <a href="?page={{ num }}">{{ num }}</a>
            </li>
            {% endfor %}
            {% if page_obj.has_next %}
            <li><a href="?page={{ page_obj.next_page_number }}">Наступна &raquo;</a></li>
            {% endif %}
        </ul>
    </nav>
    {% endif %}
</div>
</div>
<script src="https://code.jquery.com/qunit/qunit-2.19.1.js"></script>
<script src="../../js/article_list.js"></script>
<script src="article_list_test.js"></script>
</body>
</html>